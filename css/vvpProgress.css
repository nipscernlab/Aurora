/*
 * =====================================================================================
 *
 *       Filename:  vvpProgress.css
 *
 *    Description:  V2 - A focused, modern progress widget.
 *                  Redesigned for superior layout, hierarchy, and integrated animation.
 *
 * =====================================================================================
 */

/* ===================================================================================
 *  OVERLAY & MAIN CARD
 * =================================================================================== */
.vvp-progress-overlay {
  position: fixed;
  bottom: var(--space-8);
  left: 50%;
  transform: translateX(-50%);
  z-index: var(--z-max);
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--transition-slow), visibility var(--transition-slow);
  pointer-events: none;
}

.vvp-progress-overlay.vvp-progress-visible {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transform: translateX(-50%); /* Reset transform for entry animation */
  animation: floatIn var(--transition-slow) var(--transition-bounce);
}

.vvp-progress-info {
  width: clamp(340px, 90vw, 550px); /* Responsive width */
  padding: var(--space-6);
  
  background: color-mix(in srgb, var(--bg-elevated) 30%, transparent);
  backdrop-filter: blur(24px) saturate(150%);
  -webkit-backdrop-filter: blur(24px) saturate(150%);
  
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  
  display: flex;
  flex-direction: column;
  gap: var(--space-5);

  transition: border-color var(--transition-normal), box-shadow var(--transition-normal);
}

@keyframes floatIn {
  from {
    opacity: 0;
    transform: translate(-50%, var(--space-4));
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0);
  }
}

/* ===================================================================================
 *  HEADER
 * =================================================================================== */
.vvp-progress-header {
  text-align: center;
}

.vvp-progress-title {
  margin: 0;
  font-family: var(--font-display);
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--text-primary);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  transition: color var(--transition-normal);
}

/* ===================================================================================
 *  MAIN PROGRESS BAR SECTION
 * =================================================================================== */
.vvp-progress-main {
  display: flex;
  align-items: center;
  gap: var(--space-4);
}

.vvp-progress-bar {
  flex-grow: 1;
  height: 16px;
  background-color: var(--bg-tertiary);
  border-radius: var(--radius-full);
  overflow: hidden;
  position: relative;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4);
}

.vvp-progress-fill {
  height: 100%;
  width: 0%; /* Controlled by JS */
  border-radius: var(--radius-full);
  transition: width var(--transition-normal), background-color var(--transition-normal);
  
  /* The new "Aurora Flow" animation - replaces the spinner */
  background-color: var(--accent-primary);
  background-image: linear-gradient(
    90deg,
    var(--accent-primary) 0%,
    var(--accent-secondary) 25%,
    var(--accent-bright) 50%,
    var(--accent-secondary) 75%,
    var(--accent-primary) 100%
  );
  background-size: 200% 100%;
  animation: aurora-flow 3s linear infinite;
}

@keyframes aurora-flow {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.vvp-progress-percentage {
  font-family: var(--font-mono);
  font-weight: var(--font-bold);
  color: var(--text-accent);
  text-shadow: 0 0 8px var(--accent-primary);
  min-width: 60px;
  text-align: right;
  transition: color var(--transition-normal), text-shadow var(--transition-normal);
}

/* ===================================================================================
 *  STATS FOOTER
 * =================================================================================== */
.vvp-progress-stats {
  display: flex;
  justify-content: space-between;
  gap: var(--space-5);
  padding-top: var(--space-4);
  border-top: 1px solid var(--border-primary);
}

.vvp-stat {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.vvp-stat-label {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-family: var(--font-sans);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wide);
}

.vvp-stat-label i {
  font-size: var(--text-sm);
  color: var(--icon-muted);
}

.vvp-stat-value {
  font-family: var(--font-mono);
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--text-secondary);
  align-self: center;
}

/* ===================================================================================
 *  COMPONENT STATES (COMPLETE & ERROR)
 * =================================================================================== */

/* --- COMPLETE STATE --- */
.vvp-progress-info.vvp-complete {
  border-color: var(--success);
  box-shadow: var(--shadow-xl), 0 0 25px rgba(52, 211, 153, 0.4);
}
.vvp-progress-info.vvp-complete .vvp-progress-title {
  color: var(--success);
}
.vvp-progress-info.vvp-complete .vvp-progress-fill {
  background-image: none;
  background-color: var(--success);
  animation: none; /* Stop the flow animation */
}
.vvp-progress-info.vvp-complete .vvp-progress-percentage {
  color: var(--success);
  text-shadow: 0 0 8px var(--success);
}

/* --- ERROR STATE --- */
.vvp-progress-info.vvp-error {
  border-color: var(--error);
  box-shadow: var(--shadow-xl), 0 0 25px rgba(248, 113, 113, 0.4);
  animation: floatIn var(--transition-slow) var(--transition-bounce), errorShake 0.5s var(--transition-bounce);
}
.vvp-progress-info.vvp-error .vvp-progress-title {
  color: var(--error);
}
.vvp-progress-info.vvp-error .vvp-progress-fill {
  background-image: none;
  background-color: var(--error);
  animation: none;
}
.vvp-progress-info.vvp-error .vvp-progress-percentage {
  color: var(--error);
  text-shadow: 0 0 8px var(--error);
}

@keyframes errorShake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-6px); }
  40%, 80% { transform: translateX(6px); }
}

/* ===================================================================================
 *  THEME & RESPONSIVE ADJUSTMENTS
 * =================================================================================== */

/* --- Light Theme Adjustments --- */
body.theme-light .vvp-progress-info {
  background: color-mix(in srgb, var(--bg-elevated) 90%, transparent);
  border-color: var(--border-secondary);
}
body.theme-light .vvp-progress-bar {
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
}
body.theme-light .vvp-progress-info.vvp-complete {
  box-shadow: var(--shadow-xl), 0 0 25px rgba(5, 150, 105, 0.2);
}
body.theme-light .vvp-progress-info.vvp-error {
  box-shadow: var(--shadow-xl), 0 0 25px rgba(220, 38, 38, 0.2);
}

/* --- Responsive Design --- */
@media (max-width: 480px) {
  .vvp-progress-stats {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-3);
  }
}

/* --- Accessibility --- */
@media (prefers-reduced-motion: reduce) {
  .vvp-progress-overlay,
  .vvp-progress-fill {
    animation: none !important;
    transition-duration: 0.01ms !important;
  }
  .vvp-progress-fill {
    transition: width var(--transition-fast) !important;
  }
}